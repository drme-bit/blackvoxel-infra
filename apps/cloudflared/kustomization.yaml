apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
resources:
  - deployment.yaml

namespace: blackvoxel

commonLabels:
  app: cloudflared

configMapGenerator:
  - name: cloudflared-config
    files:
      - config.yml=config.yml
generatorOptions:
  disableNameSuffixHash: true

# Notes:
# - `service.yaml` previously contained a placeholder Secret manifest named `cloudflared-creds`.
#   It is intentionally not included here because `cloudflared-creds` is managed by a SealedSecret
#   (see `apps/common/cloudflared-sealedsecret.yaml`).
# - The deployment mounts the secret at /etc/cloudflared; ensure the secret contains
#   the Cloudflared credentials file under the key `credentials.json`.
# - `cloudflared-config` ConfigMap is generated from `config.yml` and mounted into the pod.
# Example to create the secret locally (not for git):
# kubectl -n blackvoxel create secret generic cloudflared-creds --from-file=credentials.json=/path/to/credentials.json
